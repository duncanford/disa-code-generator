<html>
<!--
Copyright (c) 2016, Duncan Ford
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:
    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
    * Neither the name of the <organization> nor the
      names of its contributors may be used to endorse or promote products
      derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL DUNCAN FORD BE LIABLE FOR ANY
DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->

<head>

    <link rel="stylesheet" type="text/css" href="http://codemirror.net/lib/codemirror.css">
    <link rel="stylesheet" type="text/css" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <style>
        .codeMirror {
            border: 1px solid black;
        }
        
        body {
            background: #FFF;
            color: #000;
        }
        
        .CodeMirror {
            height: auto;
        }
        
        .bs-callout {
            padding: 20px;
            margin: 20px 0px;
            border-width: 1px 1px 1px 5px;
            border-style: solid;
            border-color: #EEE;
            -moz-border-top-colors: none;
            -moz-border-right-colors: none;
            -moz-border-bottom-colors: none;
            -moz-border-left-colors: none;
            border-image: none;
            border-radius: 3px;
        }
        
        .bs-callout-info {
            border-left-color: #5BC0DE;
        }
        
        .bs-callout-danger {
            border-left-color: #D9534F;
        }
        
        img.githublogo {
            height: 72px;
            float: right;
            top: 6px;
            position: relative;
        }
        
        .tooltip {
            font-size: 1.2em;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <H1 class="col-md-8">DISA Code Template Generator</H1>
        </div>
        <p>Or perhaps you were looking for the <a href="http://tiny.cc/pw-code-generator">PW generator</a> or <a href="http://tiny.cc/prpm-code-generator">PRPM generator?</a></p>
        <div class="bs-callout bs-callout-danger">If something doesn't look right, try a modern browser</div>

        <H2>Overview</H2>
        <div class="row">
            <div class="col-md-12">
                <p>To purpose of this generator is to quickly create the content for all the separate five files you need to create a template DISA integration. Almost everything can be keyed from a single name: the name of the plugin. Even though we can collect multiple plugins in a single JAR file, keeping each plugin separate will probably aid maintenance. The generator will create a shell for you to fill with your purpose. As with the PR/PM generator, the aim is to get something running quickly that generates console-logged evidence so that you can move as quickly as possible to the point where you implement the purpose, instead of wasting a lot of time ensuring that everything matches up.</p>
            </div>
        </div>
        <H2>Details</H2>
        <div class="row">
            <div class="col-md-12">
                <p>To get started, let's capture some key details about your plugin and the location of DISA on your machine</p>
            </div>
            <form class="form-horizontal" role="form">
                <div class="form-group">
                    <label for "DISADir" class="col-sm-2 control-label"><abbr title="DISA Directory">DISA Directory</abbr></label>
                    <div class="col-sm-8">
                        <input id="DISADir" class="form-control" value="C:\DISA" placeholder="C:\DISA" />
                    </div>
                </div>
                <div class="form-group">
                    <label for "Namer" class="col-sm-2 control-label">Plugin Name</label>
                    <div class="col-sm-8">
                        <input id="Namer" class="form-control" value="CunningPlugin" placeholder="Name" />
                    </div>
                </div>
                <div class="form-group">
                    <label for "Object" class="col-sm-2 control-label">Type</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="Object">
                            <option value="DesktopForm">Desktop Form Applet</option>
                            <option value="DesktopList">Desktop List Applet</option>
                            <option value="DesktopTree">Desktop Tree Applet</option>
                            <option value="MobileList">Mobile List Applet</option>
                            <option value="MobileForm">Mobile Form Applet</option>
                            <option value="View">View</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for "Comments" class="col-sm-2 control-label">Sprinkle comments?</label>
                    <div class="col-sm-8">
                        <label class="radio-inline">
                            <input type="radio" name="Comments" id="Comments" value="Yes" checked>Yes</input>
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="Comments" id="Comments" value="No"> No</input>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for "Logging" class="col-sm-2 control-label">Add Logging?</label>
                    <div class="col-sm-8">
                        <label class="radio-inline">
                            <input type="radio" name="Logging" id="Logging" value="Yes">Yes</input>
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="Logging" id="Logging" value="No" checked> No</input>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for "UserProps" class="col-sm-2 control-label">Prepare user properties</label>
                    <div class="col-sm-8">
                        <input id="UserProps" class="form-control" placeholder="comma,separated,please" />
                    </div>
                </div>
            </form>
        </div>
        <div class="row">
            <H2>PR</H2>
            <div class="bs-callout bs-callout-info" id="instructionPR"></div>
            <textarea id="codePR"></textarea>
        </div>
        <div class="row">
            <H2>PM</H2>
            <div class="bs-callout bs-callout-info" id="instructionPM"></div>
            <textarea id="codePM"></textarea>
        </div>
        <div class="row">
            <H2>Java</H2>
            <div class="bs-callout bs-callout-info" id="instructionJava"></div>
            <textarea id="codeJava"></textarea>
        </div>
        <div class="row">
            <H2>Manifest</H2>
            <div class="bs-callout bs-callout-info" id="instructionManifest"></div>
            <textarea id="codeManifest"></textarea>
        </div>
        <div class="row">
            <H2>Build</H2>
            <div class="bs-callout bs-callout-info" id="instructionBuild"></div>
            <textarea id="codeBuild"></textarea>
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="http://codemirror.net/lib/codemirror.js"></script>
    <script src="http://codemirror.net/mode/javascript/javascript.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

    <script>
        var addComments = true;
        var addLogging = false;
        var tweaked = false;
        var cm;
        var init = true;
        var strCode;

        var storeDefExtPR = {
            "View-def": 'siebel/viewpr',
            "View-ext": 'ViewPR',
            "MobileList-def": 'siebel/jqmlistrenderer',
            "MobileList-ext": 'JQMListRenderer',
            "MobileForm-def": 'siebel/jqmformrenderer',
            "MobileForm-ext": 'JQMFormRenderer',
            "DesktopList-def": 'siebel/jqgridrenderer',
            "DesktopList-ext": 'JQGridRenderer',
            "DesktopTree-def": 'siebel/treeappletphyrenderer',
            "DesktopTree-ext": 'TreeAppletPR',
            "DesktopForm-def": 'siebel/phyrenderer',
            "DesktopForm-ext": 'PhysicalRenderer'
        }
        var storeDefExtPM = {
            "View-def": 'siebel/viewpm',
            "View-ext": 'ViewPM',
            "MobileList-def": 'siebel/listpmodel',
            "MobileList-ext": 'ListPresentationModel',
            "MobileForm-def": 'siebel/pmodel',
            "MobileForm-ext": 'PresentationModel',
            "DesktopList-def": 'siebel/listpmodel',
            "DesktopList-ext": 'ListPresentationModel',
            "DesktopTree-def": 'siebel/explorerpmodel',
            "DesktopTree-ext": 'ExplorerPresentationModel',
            "DesktopForm-def": 'siebel/pmodel',
            "DesktopForm-ext": 'PresentationModel'
        }

        $(document).ready(function () {
            bindEvents();
            SetDefault("PRPM", "prpm");
            SetDefault("Namer", "name");
            SetDefault("Object", "object");
            SetDefault("UserProps", "userprops");
            SetDefaultRadio("Comments", "comments");
            SetDefaultRadio("Logging", "logging");
            init = false;
            RegenerateCode();
            $("#Object").on("change", function () {
                RegenerateCode()
            });
            $("#DISADir").on("keyup", function () {
                RegenerateCode()
            });
            $("#PRPM").on("change", function () {
                RegenerateCode()
            });
            $("#Namer").on("keyup", function () {
                RegenerateCode()
            });
            $("#UserProps").on("keyup", function () {
                RegenerateCode()
            });
            $("input:radio[name=Logging]").click(function () {
                addLogging = $(this).val() == "Yes";
                RegenerateCode();
            });
            $("input:radio[name=Comments]").click(function () {
                addComments = $(this).val() == "Yes";
                RegenerateCode();
            });
        });

        function addCode(line) {
            return line + "\n";
        }

        function addComment(line) {
            return addComments ? line + "\n" : "";
        }

        function addPRLog(line) {
            return addLogging ? '     SiebelJS.Log(this.GetPM().Get("GetName")+": TemplatePR: ' + line + "\");\n" : "";
        }

        function addPMLog(line) {
            return addLogging ? '     SiebelJS.Log(this.Get("GetName")+": TemplatePM: ' + line + "\");\n" : "";
        }

        function RegenerateCode() {
            GenerateCode("PR");
            GenerateCode("PM");
            GenerateCode("Java");
            GenerateCode("Manifest");
            GenerateCode("Build");
            $(".CodeMirror").remove();
            CodeMirrorify();
        }

        function CodeMirrorify() {
            config = {
                lineNumbers: true,
                lineWrapping: true,
                matchBrackets: true,
                viewportMargin: Infinity,
                readOnly: true,
                mode:"javascript"
            };
            CodeMirror.fromTextArea(document.getElementById("codePR"), config);
            CodeMirror.fromTextArea(document.getElementById("codePM"), config);
            CodeMirror.fromTextArea(document.getElementById("codeJava"), config);
            CodeMirror.fromTextArea(document.getElementById("codeManifest"), config);
            CodeMirror.fromTextArea(document.getElementById("codeBuild"), {mode:"xml"});
        }

        function GenerateCode(type) {
            strCode = "";
            var userProps = $("#UserProps").val().split(",");
            switch (type) {
            case "PR":
                strCode += addCode('if (typeof(SiebelAppFacade.TemplatePR) === "undefined") {');
                strCode += addCode('');
                strCode += addCode(' SiebelJS.Namespace("SiebelAppFacade.TemplatePR");')
                strCode += addCode(' define("siebel/custom/TemplatePR", ["' + storeDefExtPR[$("#Object").val() + "-def"] + '"],');
                strCode += addCode('  function () {');
                strCode += addCode('   SiebelAppFacade.TemplatePR = (function () {');
                strCode += addCode('');
                strCode += addCode('    function TemplatePR(pm) {');
                strCode += addCode('     SiebelAppFacade.TemplatePR.superclass.constructor.apply(this, arguments);');
                /*
                		  if (userProps.length>0) {for (prop in userProps)  {
                		   if (userProps[prop]!="") {
                			strCode += addCode('     pm.AttachPMBinding("'+userProps[prop]+'",function(){console.log(pm.Get("'+userProps[prop]+'"))})')
                		   }
                		  }}
                	 SiebelJS.Log(this.GetPM().Get("GetName")+": QuoteAppletPR:      ShowUI: User Property abc has value:"+this.GetPM().Get("abc"));
                */
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addCode('    SiebelJS.Extend(TemplatePR, SiebelAppFacade.' + storeDefExtPR[$("#Object").val() + "-ext"] + ');');
                strCode += addCode('');
                strCode += addCode('    TemplatePR.prototype.Init = function () {');
                strCode += addCode('     SiebelAppFacade.TemplatePR.superclass.Init.apply(this, arguments);');
                strCode += addPRLog('     Init method reached.');
                strCode += addComment('     // attach to the PM method called by the WS when it responds');
                strCode += addCode('     this.AttachPMBinding("DISAResponse", ShowDISAResponse, {scope:this});');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addCode('    function ShowDISAResponse(response) {');
                strCode += addPRLog('     ShowDISAResponse function reached.');
                strCode += addCode('     SiebelJS.Log(response);');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addCode('    TemplatePR.prototype.ShowUI = function () {');
                strCode += addPRLog('     ShowUI method reached.');
                strCode += addCode('     SiebelAppFacade.TemplatePR.superclass.ShowUI.apply(this, arguments);');
                strCode += addComment('     // Initiate the call to the custom DISA Plugin');
                strCode += addCode('     this.GetPM().ExecuteMethod("callDISAPlugin");');
                if (userProps.length > 0) {
                    for (prop in userProps) {
                        if (userProps[prop] != "") {
                            strCode += addPRLog('     ShowUI: User Property ' + userProps[prop] + ' has value:"+this.GetPM().Get("' + userProps[prop] + '")+"');
                        }
                    }
                }
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addCode('    return TemplatePR;');
                strCode += addCode('   }()');
                strCode += addCode('  );');
                strCode += addCode('  return "SiebelAppFacade.TemplatePR";');
                strCode += addCode(' })');
                strCode += addCode('}');
                break;
            case "PM":
                strCode += addCode('if (typeof(SiebelAppFacade.TemplatePM) === "undefined") {');
                strCode += addCode('');
                strCode += addCode(' SiebelJS.Namespace("SiebelAppFacade.TemplatePM");')
                strCode += addCode(' define("siebel/custom/TemplatePM", ["' + storeDefExtPM[$("#Object").val() + "-def"] + '"],');
                strCode += addCode('  function () {');
                strCode += addCode('   SiebelAppFacade.TemplatePM = (function () {');
                strCode += addCode('');
                strCode += addCode('    var consts = SiebelJS.Dependency("SiebelApp.Constants");');
                strCode += addCode('    var DISA_PLUGIN = "plugin_<TemplateLC>";');
                strCode += addCode('    consts.set("WS_"+DISA_PLUGIN.toUpperCase()+"_VERSION", "1.0.0");');
                strCode += addCode('');
                strCode += addCode('    var DISAHandler = null;');
                strCode += addCode('    var attachedHandlers = 0;');
                strCode += addCode('');
                if (userProps.length > 0) {
                    var done = false;
                    for (prop in userProps) {
                        if (userProps[prop] != "" && !done) {
                            strCode += addCode('');
                            strCode += addCode('    var utils = SiebelJS.Dependency("SiebelApp.Utils");');
                            done = true;
                        }
                    }
                }
                strCode += addCode('');
                strCode += addCode('    function TemplatePM(pm) {');
                strCode += addCode('     SiebelAppFacade.TemplatePM.superclass.constructor.apply(this, arguments);');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addCode('    SiebelJS.Extend(TemplatePM, SiebelAppFacade.' + storeDefExtPM[$("#Object").val() + "-ext"] + ');');
                strCode += addCode('');
                strCode += addCode('    TemplatePM.prototype.Setup = function (propSet) {');
                strCode += addCode('     SiebelAppFacade.TemplatePM.superclass.Setup.apply(this, arguments);');
                strCode += addComment('     // Register a method to interface with DISA. This will be called from the PR.');
                strCode += addCode('     this.AddMethod("callDISAPlugin", callDISAPlugin, {sequence:false, scope:this});');
                strCode += addComment('     // Register a method which will carry the DISA plugin response back to the PR');
                strCode += addCode('     this.AddMethod("DISAResponse", function() {}, {});');
                strCode += addComment('     // Increase the number of attached handlers');
                strCode += addCode('     attachedHandlers++;');
                if (userProps.length > 0) {
                    for (prop in userProps) {
                        if (userProps[prop] != "") {
                            strCode += addCode('     processCustomUserProperty.call(this,propSet,"' + userProps[prop] + '")');
                        }
                    }
                }
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addCode('    TemplatePM.prototype.EndLife = function () {');
                strCode += addComment('     // Called when the PM is no longer needed');
                strCode += addCode('     SiebelAppFacade.TemplatePM.superclass.EndLife.apply(this, arguments);');
                strCode += addComment('     // Reduce attachHandlers and, if necessary, destroy the WS Handler');
                strCode += addCode('     if (--attachedHandlers == 0) {');
                strCode += addCode('      unregisterDISAHandler.call();');
                strCode += addCode('     }');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addCode('    function callDISAPlugin() {');
                strCode += addCode('     var handler = getDISAHandler.call(this);');
                strCode += addComment('     // here we create an object containing data which the Java application will read.');
                strCode += addComment('     // Neither "Command", nor "GetSysInfo" are DISA specific.');
                strCode += addComment('     // The shape and content of the message is entirely up to the developer.');
                strCode += addCode('     var msgJSON = {};');
                strCode += addCode('     msgJSON["Command"] = "<TemplateName>";');
                strCode += addCode('     handler.SendMessage(msgJSON);');
                strCode += addComment('     // the message is sent asychronously, so once the command is sent, nothing further happens');
                strCode += addComment('     // within the PR/PM until a message is received.');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addCode('    function getDISAHandler() {');
                strCode += addCode('     if (DISAHandler === null) {');
                strCode += addCode('      DISAHandler = SiebelApp.WebSocketManager.CreateWSHandler(DISA_PLUGIN);');
                strCode += addComment('     // communications with DISA are asynchronous. We define handler functions here to deal with');
                strCode += addComment('     // possible responses from DISA, such as a message or communication failure conditions.');
                strCode += addCode('      DISAHandler.OnClose = onWSClose.bind(this);');
                strCode += addCode('      DISAHandler.OnFail = onWSSendFail.bind(this);');
                strCode += addCode('      DISAHandler.OnMessage = onWSMessage.bind(this);');
                strCode += addCode('     }');
                strCode += addCode('     return DISAHandler;');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addCode('    function onWSMessage(msg, fileName) {');
                strCode += addComment('     // this is the result of callDISAPlugin if all goes well');
                strCode += addCode('     handleMsg.call(this,msg);');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addComment('    // Normally this indicates something wrong with communication attempt to operator at DISA');
                strCode += addComment('    // Maybe because Siebel OpenUI never establishes connection with DISA due to various reasons');
                strCode += addComment('    // Maybe because the version number at two sides are not matched, operator version should be equal or newer');
                strCode += addComment('    // Reset state or other variables if necessary');
                strCode += addCode('    function onWSSendFail() {');
                strCode += addCode('     handleException("Failed to send message to DISA");');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addComment('    // This indicates Siebel OpenUI with DISA connection was lost');
                strCode += addComment('    // Maybe because Siebel OpenUI never establishes connection with DISA due to various reasons');
                strCode += addComment('    // Maybe because DISA exited (by user) or crashed');
                strCode += addComment('    // Reset state or other variables if necessary');
                strCode += addCode('    function onWSClose() {');
                strCode += addCode('     handleException("Connection to DISA was lost");');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addComment('    // Called by onWSMessage event handler');
                strCode += addCode('    function handleMsg(msg) {');
                strCode += addComment('    // Log the message received');
                strCode += addPMLog('      JSON message received: " + JSON.stringify(msg) + "');
//                strCode += addCode('     SiebelJS.Log(this.Get("GetName")+": JSON message received: " + JSON.stringify(msg));');
                strCode += addComment('    // Pass the message to the PR');
                strCode += addCode('     this.ExecuteMethod("DISAResponse",msg);');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addComment('    // Called by onWSClose or onWSSendFail event handler');
                strCode += addCode('    function handleException(msg) {');
                strCode += addComment('    // Add other error handling logic');
                strCode += addCode('     SiebelJS.Log(msg);');
                strCode += addCode('    }');
                strCode += addCode('');
                strCode += addComment('    // Tidy up');
                strCode += addCode('    function unregisterDISAHandler(msg) {');
                strCode += addCode('     if (DISAHandler) {');
                strCode += addCode('      DISAHandler.Unregister();');
                strCode += addCode('      DISAHandler = null;');
                strCode += addCode('     }');
                strCode += addCode('    }');

                if (userProps.length > 0) {
                    var done = false;
                    for (prop in userProps) {
                        if (userProps[prop] != "" && !done) {
                            strCode += addCode('');
                            strCode += addCode('    function processCustomUserProperty(propSet,propertyName) {');
                            if ($("#Object").val() == "View")
                                strCode += addCode('     var userProps = propSet.GetChildByType(consts.get("SWE_VIEW_PM_PS"));');
                            else
                                strCode += addCode('     var userProps = propSet.GetChildByType(consts.get("SWE_APPLET_PM_PS"));');
                            strCode += addCode('      if (userProps) {');
                            strCode += addCode('      var propVal = userProps.GetProperty(propertyName);');
                            strCode += addCode('      if (!utils.IsEmpty(propVal)) {');
                            strCode += addCode('      this.AddProperty(propertyName, propVal);');
                            strCode += addPMLog('     "+propertyName+" user property was retrieved with value " + propVal +".');
                            strCode += addCode('     }} else {');
                            strCode += addPMLog('      Could not get the value of the "+propertyName+" user property.');
                            strCode += addCode('     }');
                            strCode += addCode('    }');
                            done = true;
                        }
                    }
                }
                strCode += addCode('');
                strCode += addCode('    return TemplatePM;');
                strCode += addCode('   }()');
                strCode += addCode('  );');
                strCode += addCode('  return "SiebelAppFacade.TemplatePM";');
                strCode += addCode(' })');
                strCode += addCode('}');
                break;
            case "Java":
                strCode += addCode('package com.siebel.wsserver.plugin;');
                strCode += addCode('');
                strCode += addCode('import com.siebel.wsserver.operator.CSSWSSingletonOperator;');
                strCode += addCode('import com.google.gson.JsonObject;');
                strCode += addCode('');
                strCode += addCode('public class CSSWS<TemplateName>Operator extends CSSWSSingletonOperator {');
                strCode += addCode('');
                strCode += addCode(' java.util.logging.Logger logger = java.util.logging.Logger.getLogger("disa.server");');
                strCode += addCode('');
                strCode += addCode(' public static final String COMMAND = "Command";');
                strCode += addCode('');
                strCode += addComment(' /*');
                strCode += addComment(' * Return the type of this plugin operator.');
                strCode += addComment(' */');
                strCode += addCode(' @Override');
                strCode += addCode(' public String getType() {');
                strCode += addCode('  logger.warning("**** PLUGIN_<TemplateUC> LOADED ****");');
                strCode += addCode('  return "plugin_<TemplateLC>";');
                strCode += addCode(' }');
                strCode += addCode('');
                strCode += addComment(' /*');
                strCode += addComment(' * Return the version of this plugin operator.');
                strCode += addComment(' */');
                strCode += addCode(' @Override');
                strCode += addCode(' public String getVersion() {');
                strCode += addCode('  return "1.0.0";');
                strCode += addCode(' }');
                strCode += addCode('');
                strCode += addCode(' @Override');
                strCode += addCode(' protected void processMessage(JsonObject msg) {');
                strCode += addCode('  if (msg.has(COMMAND)) {');
                strCode += addCode('   if (msg.get(COMMAND).getAsString().equals("<TemplateName>")) {');
                strCode += addCode('    <TemplateName>();');
                strCode += addCode('   }');
                strCode += addCode('  }');
                strCode += addCode(' }');
                strCode += addCode('');
                strCode += addCode(' private void <TemplateName>() {');
                strCode += addCode('  JsonObject response = new JsonObject();');
                strCode += addCode('  response.addProperty("DISAResponse", "Hello from <TemplateName>");');
                strCode += addCode('  sendMessage(response);');
                strCode += addCode(' }');
                strCode += addCode('}');
                break;
            case "Manifest":
                strCode += addCode('com.siebel.wsserver.plugin.CSSWS<TemplateName>Operator');
                break;
            case "Build":
                strCode += addCode('<project name="<TemplateName>" basedir="." default="buildjar">');
                strCode += addCode(' <presetdef name="javac">');
                strCode += addCode('  <javac includeantruntime="false" />');
                strCode += addCode(' </presetdef>');
                strCode += addCode(' <property name="target.name" value="<TemplateName>"/>');
                strCode += addCode(' <property name="src.dir"     value="src"/>');
                strCode += addCode(' <property name="metainf.dir" value="${src.dir}/META-INF"/>');
                strCode += addCode(' <property name="build.dir"   value="build"/>');
                strCode += addCode(' <property name="classes.dir" value="${build.dir}/classes"/>');
                strCode += addCode(' <property name="jar.dir"     value="${build.dir}/jar"/>');
                strCode += addCode(' <property name="lib.dir"     value="'+$("#DISADir").val()+'/DesktopIntSiebelAgent/lib"/>');
                strCode += addCode('');
                strCode += addCode(' <path id="classpath">');
                strCode += addCode('  <fileset dir="${lib.dir}" includes="disa-api.jar"/>');
                strCode += addCode('  <fileset dir="${lib.dir}" includes="gson.jar"/>');
                strCode += addCode(' </path>');
                strCode += addCode('');
                strCode += addCode(' <target name="clean">');
                strCode += addCode('  <delete dir="${build.dir}" />');
                strCode += addCode('  <mkdir dir="${build.dir}" />');
                strCode += addCode(' </target>');
                strCode += addCode('');
                strCode += addCode(' <target name="compile" depends="clean">');
                strCode += addCode('  <mkdir dir="${classes.dir}"/>');
                strCode += addCode('  <javac srcdir="${src.dir}" destdir="${classes.dir}" classpathref="classpath"/>');
                strCode += addCode(' </target>');
                strCode += addCode('');
                strCode += addCode(' <target name="buildjar" depends="compile">');
                strCode += addCode('  <mkdir dir="${jar.dir}"/>');
                strCode += addCode('  <jar destfile="${jar.dir}/${target.name}.jar" basedir="${classes.dir}">');
                strCode += addCode('   <metainf dir="${metainf.dir}"/>');
                strCode += addCode('  </jar>');
                strCode += addCode(' </target>');
                strCode += addCode('</project>');
                break;
            }

            // replacements
            // <TemplatePM>, <TemplatePR>, <TemplateName>, <TemplateLC>, <TemplateUC>, <TemplateProper>
            strCode = strCode.replace(/TemplatePR/g, "DISA"+$("#Namer").val() + type);
            strCode = strCode.replace(/TemplatePM/g, "DISA"+$("#Namer").val() + type);
            strCode = strCode.replace(/<TemplateLC>/g, $("#Namer").val().toLowerCase());
            strCode = strCode.replace(/<TemplateUC>/g, $("#Namer").val().toUpperCase());
            strCode = strCode.replace(/<TemplateName>/g, $("#Namer").val());
            switch(type) {
            case "PR":
            case "PM":                
                $("#instruction" + type).html("Copy and save the code below in your Siebel custom folder and call it <code> DISA" + $("#Namer").val() + type + ".js</code>. Get the <strong>cASe</strong> right, it's important.")
                if (userProps.length > 0) {
                    var done = false;
                    for (prop in userProps) {
                        if (userProps[prop] != "" && !done && $("#PRPM").val() == "PR") {
                            $("#instruction").append("<br/><mark>NOTE</mark>:To use custom user properties you will also need a custom PM.");
                            done = true;
                        }
                    }
                }
                break;
            case "Java":
                $("#instruction" + type).html("Copy and save the code below in your Java's src/com/siebel/wsserver/plugin folder and call it <code>CSSWS" + $("#Namer").val() + "Operator.java</code>. Get the <strong>cASe</strong> right, it's important.");
                break;
            case "Manifest":
                $("#instruction" + type).html("Copy and save the code below in your Java's src/META-INF/services folder and call it <code>com.siebel.wsserver.operator.CSSWSOperator</code>. Get the <strong>cASe</strong> right, it's important.");
                break;
            case "Build":
                $("#instruction" + type).html("Copy and save the code below in your Java's src folder and call it <code>build.xml</code>. Get the <strong>cASe</strong> right, it's important.");
                break;
            }
            if ($("#Object").val().match("Mobile")) {
                $("#instruction").append("<br/><mark>NOTE</mark>:Mobile types are no longer used in IP2014. Use only the Desktop types even for mobile work.");
            }
            try {
                if (!tweaked) {
                    $(parent.document.body).find("#head").remove();
                    $(parent.document.head).prepend("<title>Siebel DISA Code Generator</title>")
                    $(parent.document.body).append("<style>#tabs #result.tCont {padding: 0;}</style>");
                    tweaked = true;
                }
                if (!init) {
                    var url = "prpm=" + $("#PRPM").val();
                    url += "&object=" + $("#Object").val();
                    url += "&name=" + $("#Namer").val();
                    url += "&userprops=" + $("#UserProps").val();
                    url += "&comments=" + (addComments ? "Yes" : "No");
                    url += "&logging=" + (addLogging ? "Yes" : "No");
                    parent.history.replaceState({}, parent.document.title, "?" + url);
                    switch(type) {
                        case "PR":
                        case "PM":
                        case "Java":
                            strCode = addCode("//Regenerate using:" + parent.document.location.href) + strCode;
                            break;
                    }
                }
            } catch (e) {}
            $("#code" + type).text(strCode);
        }

        function getQueryVariable(variable) {
            var query = parent.location.search.substring(1);
            var vars = query.split('&');
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split('=');
                if (pair[0] == variable) {
                    return pair[1];
                }
            }
            console.log('Query variable %s not found', variable);
        }

        function SetDefault(input, qs) {
            if (getQueryVariable(qs) != undefined) {
                $("#" + input).val(getQueryVariable(qs));
            }
        }

        function SetDefaultRadio(input, qs) {
            if (getQueryVariable(qs) != undefined) {
                $('input:radio[name=' + input + ']').filter('[value=' + getQueryVariable(qs) + ']').prop('checked', true).trigger("click");
            }
        }

        function bindEvents() {
            $('[data-toggle="tooltip"]').tooltip();
        }


        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        setTimeout(function () {
            ga('create', 'UA-56575497-3', 'auto');
            ga('send', 'pageview');
        }, 0);
    </script>
</body>

</html>